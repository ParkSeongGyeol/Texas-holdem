# 텍사스 홀덤 포커 게임 규칙

**작성자**: 박성결
**작성일**: 2025-10-01
**목적**: 게임 진행 로직 구현을 위한 텍사스 홀덤 규칙 정리

---

## 📚 목차
1. [게임 개요](#게임-개요)
2. [게임 준비](#게임-준비)
3. [게임 진행 단계](#게임-진행-단계)
4. [베팅 액션](#베팅-액션)
5. [팟 분배 규칙](#팟-분배-규칙)
6. [승자 판정](#승자-판정)

---

## 게임 개요

### 기본 정보
- **게임 종류**: 텍사스 홀덤 (Texas Hold'em)
- **플레이어 수**: 2~10명 (본 프로젝트는 2명 기준)
- **사용 카드**: 52장 표준 덱 (조커 제외)
- **목표**: 최고의 5장 카드 조합을 만들어 팟(Pot)을 획득

### 핵심 개념
- **홀 카드 (Hole Cards)**: 각 플레이어에게 개별적으로 지급되는 2장의 비공개 카드
- **커뮤니티 카드 (Community Cards)**: 테이블 중앙에 공개되는 5장의 공용 카드
- **팟 (Pot)**: 플레이어들이 베팅한 칩의 총합
- **핸드 (Hand)**: 홀 카드 2장 + 커뮤니티 카드 5장 중 최고의 5장 조합

---

## 게임 준비

### 1. 초기 설정
```
- 플레이어 수: 2명 이상
- 각 플레이어 초기 칩: 1000 (기본값)
- 딜러 버튼 위치: 랜덤 선정 또는 첫 플레이어
```

### 2. 포지션
```
┌──────────────────────────────┐
│  딜러 버튼 (Dealer Button)    │
│  ↓                           │
│  스몰 블라인드 (Small Blind)  │  - 강제 베팅 (팟의 1/2)
│  ↓                           │
│  빅 블라인드 (Big Blind)      │  - 강제 베팅 (팟의 기준)
└──────────────────────────────┘
```

**참고**: 2인 플레이 시 딜러가 스몰 블라인드를 겸함

### 3. 블라인드 (Blinds)

#### 블라인드란?
블라인드는 **매 핸드마다 자동으로 내야 하는 강제 베팅**입니다. 이는 게임을 시작하게 만드는 "기본 판돈"의 역할을 합니다.

**왜 필요한가?**
- 블라인드가 없으면 모든 플레이어가 좋은 패만 기다리며 게임이 진행되지 않음
- 강제 베팅으로 팟(판돈)을 만들어 게임 진행을 유도
- 리스크를 부담하며 적극적인 플레이를 장려

#### 블라인드 종류

**스몰 블라인드 (Small Blind)**
- 금액: 최소 베팅액의 절반 (예: 5칩)
- 위치: 딜러 버튼 왼쪽 (시계방향 첫 번째)
- 역할: 게임 참여를 위한 최소 비용

**빅 블라인드 (Big Blind)**
- 금액: 최소 베팅액 (예: 10칩)
- 위치: 딜러 버튼 왼쪽 (시계방향 두 번째)
- 역할: 한 라운드의 기본 베팅 단위

#### 게임 시작 시 블라인드 처리

**2인 게임 예시**
```
게임 시작 전:
플레이어 A (딜러/스몰 블라인드): 1000칩
플레이어 B (빅 블라인드): 1000칩
팟: 0칩

블라인드 강제 베팅 후:
플레이어 A: 995칩 (5칩 자동 베팅 → 팟)
플레이어 B: 990칩 (10칩 자동 베팅 → 팟)
팟: 15칩 ← 기본 판돈 형성!
```

**4인 게임 예시**
```
게임 시작 전:
플레이어 A (딜러): 1000칩
플레이어 B (스몰 블라인드): 1000칩
플레이어 C (빅 블라인드): 1000칩
플레이어 D: 1000칩
팟: 0칩

블라인드 강제 베팅 후:
플레이어 A (딜러): 1000칩 (베팅 없음)
플레이어 B (SB): 995칩 (5칩 → 팟)
플레이어 C (BB): 990칩 (10칩 → 팟)
플레이어 D: 1000칩 (베팅 없음)
팟: 15칩
```

#### 프리플롭 베팅 예시 (2인 게임)

카드를 받은 후, 현재 상황:
```
팟: 15칩
플레이어 A (딜러/SB): 이미 5칩 베팅함
플레이어 B (BB): 이미 10칩 베팅함
현재 베팅액 기준: 10칩
```

**플레이어 A의 선택지**:
1. **폴드**: 5칩을 포기하고 이 핸드 종료
2. **콜**: 5칩을 추가로 내서 B와 동일하게 (총 10칩 베팅)
3. **레이즈**: 10칩보다 더 많이 베팅 (예: 총 20칩)

만약 A가 **콜 (5칩 추가)**:
```
플레이어 A: 990칩 (총 10칩 베팅)
플레이어 B: 990칩 (총 10칩 베팅)
팟: 20칩
→ 베팅액이 같으므로 플롭으로 진행!
```

만약 A가 **레이즈 (총 20칩)**:
```
플레이어 A: 985칩 (총 20칩 베팅)
플레이어 B: 990칩 (아직 10칩만 베팅)
팟: 30칩
→ B가 콜/레이즈/폴드 선택해야 함
```

B가 **콜 (10칩 추가)**:
```
플레이어 A: 985칩 (총 20칩)
플레이어 B: 980칩 (총 20칩)
팟: 40칩
→ 베팅액이 같으므로 플롭으로!
```

#### 프리플롭 베팅 예시 (4인 게임)

카드를 받은 후, 액션 순서:
```
팟: 15칩
B (SB): 5칩 베팅
C (BB): 10칩 베팅
현재 베팅 기준: 10칩
```

**베팅 순서**: D → A (딜러) → B → C

1. **플레이어 D**:
   - 콜(10칩) / 레이즈(20칩+) / 폴드 선택
   - D가 콜(10칩) 선택
   ```
   팟: 25칩, D는 10칩 베팅
   ```

2. **플레이어 A (딜러)**:
   - 콜(10칩) / 레이즈 / 폴드
   - A가 레이즈(총 30칩) 선택
   ```
   팟: 55칩, A는 30칩 베팅, 현재 베팅 기준: 30칩
   ```

3. **플레이어 B (SB)**:
   - 이미 5칩 베팅했으므로 25칩 추가로 콜 가능
   - 콜(25칩 추가) / 레이즈 / 폴드
   - B가 폴드 선택
   ```
   팟: 55칩 (B의 5칩 포함)
   ```

4. **플레이어 C (BB)**:
   - 이미 10칩 베팅, 20칩 추가로 콜 가능
   - C가 콜(20칩 추가)
   ```
   팟: 75칩, C는 총 30칩 베팅
   ```

5. **플레이어 D**:
   - 이미 10칩 베팅, 20칩 추가로 콜 필요
   - D가 콜(20칩 추가)
   ```
   팟: 95칩, D는 총 30칩 베팅
   ```

**결과**: A, C, D 모두 30칩씩 베팅 → 플롭으로 진행!

#### 포지션 로테이션

매 핸드마다 딜러 버튼이 **시계방향으로 1칸 이동**하여 공평하게 블라인드를 부담합니다.

**2인 게임**:
```
1번째 핸드:
A = 딜러/스몰 블라인드 (5칩)
B = 빅 블라인드 (10칩)

2번째 핸드:
B = 딜러/스몰 블라인드 (5칩)
A = 빅 블라인드 (10칩)
```

**4인 게임**:
```
1번째 핸드:
A = 딜러
B = 스몰 블라인드 (5칩)
C = 빅 블라인드 (10칩)
D = 일반

2번째 핸드:
B = 딜러
C = 스몰 블라인드 (5칩)
D = 빅 블라인드 (10칩)
A = 일반

3번째 핸드:
C = 딜러
D = 스몰 블라인드 (5칩)
A = 빅 블라인드 (10칩)
B = 일반
```

#### 블라인드의 전략적 의미

- **빅 블라인드**: 레이즈 크기의 기준 단위 (예: "빅 블라인드의 3배 레이즈" = 30칩)
- **포지션 불리**: 블라인드 위치는 먼저 베팅해야 하므로 정보가 적어 불리함
- **강제 참여**: 좋지 않은 패라도 블라인드로 일부 투자했으므로 판단이 어려움

---

## 게임 진행 단계

### 단계 개요
```
1. 프리플롭 (Preflop)   - 홀 카드 2장 배분 후 첫 베팅
2. 플롭 (Flop)          - 커뮤니티 카드 3장 공개 후 베팅
3. 턴 (Turn)            - 커뮤니티 카드 1장 추가 공개 후 베팅
4. 리버 (River)         - 커뮤니티 카드 1장 추가 공개 후 베팅
5. 쇼다운 (Showdown)    - 남은 플레이어 패 비교, 승자 결정
```

### 1. 프리플롭 (Preflop)

#### 카드 배분
1. 딜러가 덱을 섞음 (Fisher-Yates 알고리즘)
2. 각 플레이어에게 홀 카드 2장을 시계 방향으로 한 장씩 배분
3. 홀 카드는 본인만 볼 수 있음

#### 베팅 라운드
1. 빅 블라인드 왼쪽 플레이어부터 시작 (2인 플레이 시 딜러/스몰 블라인드)
2. 각 플레이어는 차례대로 액션 선택
3. 모든 플레이어가 동일한 금액을 베팅하거나 폴드하면 종료

### 2. 플롭 (Flop)

#### 카드 공개
1. **번 카드 (Burn Card)**: 덱 맨 위 카드 1장을 버림 (부정 방지)
2. 커뮤니티 카드 3장을 동시에 공개
3. 현재 커뮤니티 카드: 3장

#### 베팅 라운드
1. 딜러 버튼 왼쪽 플레이어부터 시작 (스몰 블라인드 위치)
2. 액션 선택 후 시계 방향 진행
3. 베팅 라운드 종료 조건 충족 시 다음 단계

### 3. 턴 (Turn, 4th Street)

#### 카드 공개
1. 번 카드 1장 버림
2. 커뮤니티 카드 1장 추가 공개
3. 현재 커뮤니티 카드: 4장

#### 베팅 라운드
- 플롭과 동일한 방식으로 진행

### 4. 리버 (River, 5th Street)

#### 카드 공개
1. 번 카드 1장 버림
2. 커뮤니티 카드 1장 추가 공개 (마지막)
3. 현재 커뮤니티 카드: 5장

#### 베팅 라운드
- 마지막 베팅 라운드
- 턴과 동일한 방식으로 진행

### 5. 쇼다운 (Showdown)

#### 패 비교
1. 리버 베팅 라운드 종료 후 2명 이상 남은 경우 진행
2. 마지막으로 공격적 액션(레이즈)을 한 플레이어부터 패 공개
3. 홀 카드 2장 + 커뮤니티 카드 5장 중 최고의 5장 조합으로 승부
4. 족보가 높은 플레이어가 팟 획득

---

## 베팅 액션

### 액션 종류

#### 1. 폴드 (Fold)
- **설명**: 패를 버리고 해당 핸드에서 포기
- **조건**: 언제나 가능
- **효과**:
  - 현재까지 베팅한 칩은 포기
  - 해당 핸드에서 제외 (`has_folded = True`, `is_active = False`)
- **구현**:
  ```python
  player.fold()
  ```

#### 2. 체크 (Check)
- **설명**: 베팅하지 않고 차례를 넘김
- **조건**:
  - 현재 베팅 라운드에서 아무도 베팅하지 않았을 때만 가능
  - `current_bet == 0` 또는 `player.current_bet == game.current_bet`
- **효과**:
  - 칩 변동 없음
  - 다음 플레이어에게 차례 이동
- **구현**:
  ```python
  # 베팅 없이 차례만 넘김
  pass
  ```

#### 3. 콜 (Call)
- **설명**: 현재 베팅액에 맞춤
- **조건**:
  - 다른 플레이어가 베팅했을 때
  - `game.current_bet > player.current_bet`
- **효과**:
  - 현재 베팅액과 자신의 베팅액 차이만큼 추가 베팅
  - `amount = game.current_bet - player.current_bet`
- **구현**:
  ```python
  call_amount = game.current_bet - player.current_bet
  player.bet(call_amount)
  ```

#### 4. 레이즈 (Raise)
- **설명**: 현재 베팅액보다 더 많이 베팅
- **조건**:
  - 레이즈 금액은 현재 베팅액의 최소 2배 이상
  - `raise_amount >= game.current_bet * 2`
- **효과**:
  - 베팅액 상승
  - 다른 플레이어들은 새로운 베팅액에 맞춰야 함
  - `game.current_bet` 갱신
- **구현**:
  ```python
  raise_amount = amount  # amount는 총 베팅액
  to_call = game.current_bet - player.current_bet
  additional = raise_amount - to_call
  player.bet(raise_amount)
  game.current_bet = player.current_bet
  ```

#### 5. 올인 (All-in)
- **설명**: 보유한 모든 칩을 베팅
- **조건**: 언제나 가능
- **효과**:
  - 모든 칩을 베팅
  - 이후 베팅 라운드에 참여하지 않음 (자동 체크)
  - 사이드 팟 발생 가능
  - `is_all_in = True`
- **구현**:
  ```python
  player.bet(player.chips)  # 자동으로 is_all_in = True 설정됨
  ```

### 베팅 라운드 진행 방식

#### 시작 조건
- 스몰 블라인드, 빅 블라인드 자동 베팅 (프리플롭)
- 이후 라운드는 베팅 없이 시작

#### 진행 순서
1. 현재 플레이어 액션 선택
2. 시계 방향으로 다음 플레이어
3. 모든 플레이어 베팅액 일치 시까지 반복

#### 종료 조건
아래 조건 중 하나 충족 시 베팅 라운드 종료:

1. **모든 플레이어 폴드 (1명 제외)**
   - 남은 플레이어가 즉시 팟 획득
   - 쇼다운 없이 게임 종료

2. **모든 활성 플레이어 베팅액 일치**
   - `all(p.current_bet == game.current_bet for p in active_players)`
   - 모든 플레이어가 최소 1번씩 액션 수행
   - 다음 게임 단계로 진행

3. **올인 상황**
   - 올인한 플레이어는 추가 베팅 불가
   - 다른 플레이어들끼리만 베팅 계속 (사이드 팟)

---

## 팟 분배 규칙

### 메인 팟 (Main Pot)

#### 정의
- 모든 플레이어가 참여할 수 있는 기본 팟
- 가장 적게 베팅한 플레이어 기준으로 계산

#### 계산 방식
```
메인 팟 = min(각 플레이어 총 베팅액) × 플레이어 수
```

#### 예시
```
플레이어 A: 100 베팅
플레이어 B: 100 베팅
플레이어 C: 100 베팅
→ 메인 팟 = 100 × 3 = 300
```

### 사이드 팟 (Side Pot)

#### 발생 조건
- 한 명 이상의 플레이어가 올인했을 때
- 다른 플레이어들이 올인 금액보다 더 많이 베팅한 경우

#### 계산 방식
```
1. 올인 플레이어를 베팅액 오름차순 정렬
2. 각 올인 금액 레벨별로 팟 분리
3. 높은 베팅액 플레이어들끼리만 경쟁할 수 있는 추가 팟 생성
```

#### 예시
```
플레이어 A: 50 (올인)
플레이어 B: 100 (올인)
플레이어 C: 200

계산:
메인 팟 = 50 × 3 = 150 (A, B, C 모두 경쟁)
사이드 팟 1 = (100-50) × 2 = 100 (B, C만 경쟁)
사이드 팟 2 = (200-100) × 1 = 100 (C만 독차지)
```

#### 분배 순서
1. 메인 팟 분배 (모든 플레이어 참여)
2. 사이드 팟 1 분배 (올인 금액 이상 베팅한 플레이어만)
3. 사이드 팟 2 분배 (최고액 베팅 플레이어들)

### 분할 (Split Pot)

#### 동일한 족보인 경우
- 여러 플레이어가 동일한 최고 족보를 가진 경우
- 팟을 동등하게 분할

#### 분할 방식
```python
# 승자가 2명인 경우
pot_per_winner = pot // num_winners
remainder = pot % num_winners

# 나머지 칩 처리: 딜러 버튼에 가까운 플레이어부터 1칩씩
```

#### 예시
```
팟: 105
승자: 3명
→ 각 35칩, 딜러 버튼에 가까운 순서로 추가 칩 분배 (0칩 남음)
```

---

## 승자 판정

### 판정 시점
- 쇼다운 단계에서 2명 이상 남은 경우
- 또는 모든 플레이어가 폴드하고 1명만 남은 경우 (즉시 승리)

### 판정 기준

#### 1. 족보 (Hand Rank) 비교
족보 우선순위 (높은 순서):

1. **로열 플러시 (Royal Flush)**
   - 같은 무늬의 A-K-Q-J-10
   - 예: ♠A ♠K ♠Q ♠J ♠10

2. **스트레이트 플러시 (Straight Flush)**
   - 같은 무늬의 연속된 5장
   - 예: ♥9 ♥8 ♥7 ♥6 ♥5

3. **포카드 (Four of a Kind)**
   - 같은 숫자 4장
   - 예: ♠K ♥K ♦K ♣K ♠3

4. **풀하우스 (Full House)**
   - 같은 숫자 3장 + 같은 숫자 2장
   - 예: ♠Q ♥Q ♦Q ♠7 ♥7

5. **플러시 (Flush)**
   - 같은 무늬 5장 (연속 불필요)
   - 예: ♦K ♦10 ♦7 ♦5 ♦2

6. **스트레이트 (Straight)**
   - 연속된 숫자 5장 (무늬 무관)
   - 예: ♠9 ♥8 ♦7 ♣6 ♠5
   - 백스트레이트: A-2-3-4-5 (A는 1로 취급)

7. **트리플 (Three of a Kind)**
   - 같은 숫자 3장
   - 예: ♠J ♥J ♦J ♠9 ♥5

8. **투페어 (Two Pair)**
   - 같은 숫자 2장 + 다른 같은 숫자 2장
   - 예: ♠10 ♥10 ♠6 ♥6 ♠K

9. **원페어 (One Pair)**
   - 같은 숫자 2장
   - 예: ♠A ♥A ♠K ♥Q ♠J

10. **하이카드 (High Card)**
    - 위 조합이 없을 때
    - 가장 높은 카드로 승부
    - 예: ♠A ♥K ♦10 ♣7 ♠3

#### 2. 키커 (Kicker) 비교
같은 족보일 때 나머지 카드로 승부 결정

**비교 순서**:
1. 족보 구성 카드의 랭크 비교
2. 키커 카드 높은 순서로 비교
3. 모두 같으면 무승부 (Split Pot)

**예시**:
```
플레이어 A: ♠A ♥A ♠K ♥Q ♠J (원페어 - A)
플레이어 B: ♠K ♥K ♠A ♥Q ♠J (원페어 - K)
→ A 승리 (페어 랭크가 더 높음)

플레이어 A: ♠A ♥A ♠K ♥Q ♠J (원페어 - A, 키커 K-Q-J)
플레이어 B: ♠A ♦A ♠K ♥10 ♠9 (원페어 - A, 키커 K-10-9)
→ A 승리 (두 번째 키커 Q > 10)
```

### 판정 알고리즘

```python
def determine_winner(players: List[Player], community_cards: List[Card]):
    # 1. 각 플레이어의 최고 5장 조합 찾기 (C(7,5) = 21가지)
    # 2. 족보 평가
    # 3. 족보 및 키커 비교
    # 4. 승자(들) 반환

    best_hands = []
    for player in players:
        if not player.has_folded:
            all_cards = player.hand + community_cards  # 7장
            best_hand = evaluate_best_hand(all_cards)   # 최고 5장
            best_hands.append((player, best_hand))

    # 족보 비교 (HandEvaluator.compare_hands 사용)
    winners = find_highest_hands(best_hands)
    return winners
```

---

## 특수 상황 처리

### 1. 조기 종료
- 마지막 1명만 남고 모두 폴드한 경우
- 남은 플레이어가 즉시 팟 획득
- 홀 카드 공개 불필요

### 2. 칩 소진
- 특정 플레이어의 칩이 0이 되면
- 해당 플레이어는 `is_active = False`
- 다음 핸드 참여 불가

### 3. 2인 게임 특수 규칙
- 딜러가 스몰 블라인드 겸임
- 딜러가 프리플롭에서 먼저 액션
- 플롭 이후는 빅 블라인드(논-딜러)가 먼저 액션

### 4. 베팅 제한
- **노 리미트 (No Limit)**: 베팅 제한 없음 (본 프로젝트 적용)
- 최소 레이즈: 이전 베팅의 2배 이상
- 최대 베팅: 보유 칩 전부 (올인)

---

## 참고 자료

### 구현 시 주의사항
1. **번 카드**: 플롭/턴/리버 전에 반드시 1장 버리기
2. **베팅 라운드 종료**: 모든 플레이어 베팅액 일치 확인
3. **사이드 팟**: 올인 플레이어 발생 시 정확한 팟 분리
4. **딜러 버튼**: 매 핸드마다 시계방향으로 1칸 이동

### 관련 파일
- `src/core/game.py` - 게임 진행 로직 구현
- `src/core/player.py` - 플레이어 액션 구현
- `src/algorithms/hand_evaluator.py` - 족보 판정 알고리즘

---

**문서 버전**: 1.0
**최종 수정**: 2025-10-01
